<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Generator Soal Pesantren</title>

<!-- Font Arab: Scheherazade New (dipertahankan) -->
<link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">

<style>
/* --------------------------------------------------------------
   GLOBAL STYLE
-------------------------------------------------------------- */
:root{
  --primary:#4c82ff;
  --danger:#d33;
  --card-bg:#fff;
  --page-bg:#eaf0f9;
}

html,body{
    margin:0;
    background:var(--page-bg);
    font-family:Arial, Helvetica, sans-serif;
    padding:20px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    color:#222;
}

.wrap{
    max-width:520px;
    margin:auto;
}

/* --------------------------------------------------------------
   CARD
-------------------------------------------------------------- */
.card{
    background:var(--card-bg);
    padding:22px;
    border-radius:26px;
    box-shadow:0 8px 24px rgba(0,0,0,0.09);
    margin-bottom:22px;
}

h2,h3{ margin:0 0 12px 0; }

/* labels */
label{
    font-weight:600;
    font-size:14px;
    margin-bottom:5px;
    display:block;
}

/* input & select */
input, select{
    width:100%;
    padding:12px;
    border-radius:14px;
    border:1px solid #cfd9ea;
    background:#f9fbff;
    font-size:15px;
    margin-bottom:14px;
    box-sizing:border-box;
}

/* textarea soal */
textarea{
    width:100%;
    padding:14px;
    border-radius:16px;
    border:1px solid #cfd9ea;
    background:#fafcff;
    font-size:16px;
    min-height:140px;
    resize:none;
    box-shadow:inset 0 0 5px rgba(0,0,0,0.03);
    box-sizing:border-box;
}

/* toggle */
.toggleBox{
    width:100%;
    background:#f0f4fa;
    border-radius:25px;
    padding:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:14px;
    box-sizing:border-box;
}
.toggleBtn{
    width:52px;
    height:24px;
    background:#cdd8eb;
    border-radius:20px;
    position:relative;
    cursor:pointer;
}
.toggleKnob{
    width:22px;
    height:22px;
    background:white;
    border-radius:50%;
    position:absolute;
    top:1px;
    left:1px;
    transition:.25s;
}
.toggleKnob.rtl{ left:29px; }

/* tombol utama */
button{
    width:100%;
    padding:12px;
    font-size:15px;
    border:none;
    border-radius:14px;
    background:var(--primary);
    color:white;
    font-weight:600;
    margin-top:10px;
    cursor:pointer;
}
button.red{ background:var(--danger); }
button.small{
    font-size:13px;
    padding:8px 14px;
    width:auto;
}

/* tabel */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
table td{
    padding:7px;
    border-bottom:1px solid #e6e8ee;
    font-size:14px;
    vertical-align:top;
}
.iconBtn{
    padding:6px 10px;
    border-radius:10px;
    border:none;
    background:#e8f0ff;
    color:#2756d8;
    font-size:12px;
    cursor:pointer;
}
.iconBtn.del{
    background:#ffe5e7;
    color:#c22;
}

/* PRINT AREA (style untuk PDF) */
.paper{
    width:210mm;
    min-height:330mm;
    padding:15mm;
    box-sizing:border-box;
    font-size:14px;
    color:#000;
}

/* --------------------------------------------------------------
   TOAST
-------------------------------------------------------------- */
#toast{
    position:fixed;
    top:-80px;
    left:50%;
    transform:translateX(-50%);
    background:var(--primary);
    color:white;
    padding:14px 24px;
    border-radius:12px;
    font-weight:600;
    box-shadow:0 8px 24px rgba(0,0,0,0.2);
    transition:0.35s;
    z-index:999999;
    opacity:0;
}
#toast.show{ top:20px; opacity:1; }

/* MODAL BACKDROP */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(2px);
  justify-content: center;
  align-items: center;
  z-index: 999;
}

/* Box untuk modal kecil (edit / rename) */
.edit-box {
  width: 92%;
  max-width: 420px;
  background: #fff;
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  animation: pop 0.22s ease;
}
@keyframes pop {
  from { transform: translateY(8px) scale(0.98); opacity: 0; }
  to   { transform: translateY(0) scale(1); opacity: 1; }
}
.modal-title {
  text-align: center;
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 12px;
  color: #333;
}

/* Label & input pada modal */
.input-label { font-size:14px; font-weight:600; margin-top:8px; }
.input-field { width:100%; padding:10px 12px; margin-top:6px; border-radius:10px; border:1px solid #ddd; background:#fafafa; font-size:15px; box-sizing:border-box; }

/* Textarea kecil */
.textarea { height:80px; resize:none; }

/* Modal actions */
.modal-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }
.btn { padding:10px 16px; border-radius:12px; font-size:14px; font-weight:600; border:none; cursor:pointer; }
.btn.cancel { background:#eee; color:#444; }
.btn.save { background:var(--primary); color:white; }

/* ARABIC font enforcement for RTL content */
.arabic, [dir="rtl"] {
    font-family: 'Scheherazade New', serif !important;
    /* sesuaikan ukuran untuk tampilan & PDF */
    -webkit-font-feature-settings: "kern" 1;
    font-size:16px;
    line-height:1.6;
}

/* untuk area preview PDF (konten yang di-inject ke iframe / html2pdf) */
.pdf-arabic { font-family: 'Scheherazade New', serif !important; }

/* responsive kecil */
@media (max-width:520px){
  .card{ padding:16px; border-radius:18px; }
  textarea{ min-height:120px; }
}
/* RESPONSIVE FRAMEWORK - COPY PASTE INI SAJA */
@media (max-width: 480px) {
    html, body { 
        padding: 10px !important; 
        font-size: 14px; 
    }
    .wrap { 
        max-width: 100% !important; 
        padding: 0 5px; 
    }
    .card { 
        padding: 16px !important; 
        margin-bottom: 16px !important; 
    }
    input, select, textarea { 
        padding: 10px !important; 
        font-size: 14px !important; 
    }
    textarea { 
        min-height: 110px !important; 
    }
    h2 { font-size: 20px !important; }
    h3 { font-size: 16px !important; }
    table td { 
        padding: 5px !important; 
        font-size: 13px !important; 
    }
    button { 
        padding: 10px !important; 
        font-size: 14px !important; 
    }
}

@media (min-width: 481px) and (max-width: 768px) {
    .wrap { max-width: 95% !important; }
    html, body { padding: 15px !important; }
}

@media (min-width: 769px) {
    .wrap { 
        max-width: 520px !important; 
        padding: 0 !important; 
    }
    html, body { 
        padding: 20px !important; 
    }
}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

</style>
</head>

<body>
<div id="toast" role="status" aria-live="polite"></div>

<!-- RESET CONFIRM -->
<div id="confirmOverlay" class="modal" aria-hidden="true">
    <div class="edit-box" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
        <h3 id="confirmTitle" class="modal-title">Reset Semua Soal?</h3>
        <div style="display:flex; gap:10px; margin-top:12px;">
            <button class="btn cancel" onclick="hideConfirm()">Batal</button>
            <button class="btn save" style="background:var(--danger);" onclick="doReset()">Ya, Reset</button>
        </div>
    </div>
</div>

<!-- DELETE CONFIRM -->
<div id="deleteOverlay" class="modal" aria-hidden="true">
    <div class="edit-box" role="dialog" aria-modal="true">
        <h3 class="modal-title">Hapus Soal Ini?</h3>
        <div style="display:flex; gap:10px; margin-top:12px;">
            <button class="btn cancel" onclick="hideDeleteConfirm()">Batal</button>
            <button class="btn save" style="background:var(--danger);" onclick="doDelete()">Ya, Hapus</button>
        </div>
    </div>
</div>

<div class="wrap">

    <!-- INPUT -->
    <div class="card" id="inputCard">
        <h2 style="margin-top:0;text-align:center">Generator Soal Pesantren</h2>

        <label>Semester</label>
        <select id="semester" aria-label="Semester">
            <option value="I">Semester I</option>
            <option value="II">Semester II</option>
        </select>

        <label>Tahun Pelajaran</label>
        <input id="tahun" placeholder="2025/2026" aria-label="Tahun Pelajaran">

        <label>Fan / Mapel (Arab)</label>
        <input id="fan" placeholder="مثال : التوحيد" style="direction:rtl;text-align:right" aria-label="Fan Mapel">

        <label>Kelas</label>
        <select id="kelas" aria-label="Kelas">
            <option>SP (Sekolah Persiapan)</option><option>I (Satu)</option><option>II (Dua)</option>
            <option>III (Tiga)</option><option>IV (Empat)</option><option>I (Satu Putri)</option><option>II (Dua Putri)</option>
            <option>III (Tiga Putri)</option><option>IV (Empat Putri)</option>
        </select>

        <!-- toggle -->
        <div class="toggleBox" aria-hidden="false">
            <span id="modeLabel">Arab (RTL)</span>
            <div class="toggleBtn" onclick="toggleMode()" role="button" aria-pressed="true" tabindex="0">
                <div class="toggleKnob rtl" id="knob"></div>
            </div>
        </div>

        <label>Tulis Soal</label>
        <textarea id="soalInput" dir="rtl" style="text-align:right" placeholder="Tulis soal disini....." aria-label="Tulis Soal"></textarea>

        <button onclick="addSoal()">Tambah Soal</button>
    </div>

    <!-- LIST -->
    <div class="card">
        <h3 style="margin-top:0">Daftar Soal (<span id="totalCount">0</span>)</h3>
        <table>
            <tbody id="tbodySoal" aria-live="polite"></tbody>
        </table>

        <div style="display:flex; gap:10px;">
            <button onclick="openPreview()" class="small">Lihat & Cetak</button>
            <button onclick="openRename()" class="small">Download PDF</button>
            <button class="red" onclick="showConfirm()">Reset</button>
        </div>
    </div>

</div>

<!-- HIDDEN IFRAME (tidak lagi digunakan untuk PDF, tapi tetap ada) -->
<iframe id="printFrame" style="display:none;"></iframe>

<!-- MODAL EDIT -->
<div id="editModal" class="modal" aria-hidden="true">
  <div class="edit-box" role="dialog" aria-modal="true">
    <h2 class="modal-title">Edit Soal</h2>

    <label class="input-label">Teks Soal</label>
    <textarea id="editQuestion" class="input-field textarea"></textarea>

    <div class="modal-actions" style="display:flex;justify-content:flex-end;gap:10px;">
      <button class="btn cancel" onclick="closeEdit()">Batal</button>
      <button class="btn save" onclick="saveEdit()">Simpan</button>
    </div>
  </div>
</div>

<!-- MODAL RENAME & DOWNLOAD (kecil seperti edit) -->
<div id="renameModal" class="modal" aria-hidden="true">
  <div class="edit-box" role="dialog" aria-modal="true">
    <h2 class="modal-title">Nama File PDF</h2>

    <label class="input-label">Nama File</label>
    <input id="fileNameInput" class="input-field" />

    <div class="modal-actions" style="display:flex;justify-content:flex-end;">
      <button class="btn cancel" onclick="closeRename()">Batal</button>
      <button class="btn save" onclick="confirmDownloadPDF()">Download</button>
    </div>
  </div>
</div>

<!-- SCRIPT: html2pdf (CDN) digunakan untuk export PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

<script>
/* -------------------------
   DATA & INIT
   ------------------------- */
let daftar = JSON.parse(localStorage.getItem("soal_asli") || "[]");
let modeArab = true; // default RTL

const arabDigits = ["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];

function toArabicNumber(n){
    return String(n).split("").map(c => /\d/.test(c) ? arabDigits[+c] : c).join("");
}

function toast(msg){
    const t = document.getElementById("toast");
    t.innerText = msg;
    t.classList.add("show");
    setTimeout(()=> t.classList.remove("show"), 2200);
}

/* -------------------------
   RENDER LIST
   ------------------------- */
function renderList(){
    const tbody = document.getElementById("tbodySoal");
    tbody.innerHTML = "";

    daftar.forEach((it, i) => {
        const tr = document.createElement("tr");

        const tdNo = document.createElement("td");
        tdNo.style.fontWeight = "700";
        tdNo.style.width = "36px";
        tdNo.textContent = it.mode === "arab" ? toArabicNumber(i+1) : (i+1);

        const tdText = document.createElement("td");
        tdText.textContent = it.text;
        tdText.style.textAlign = it.mode === "arab" ? "right" : "left";
        if(it.mode === "arab") tdText.classList.add("arabic");

        const tdAct = document.createElement("td");
        tdAct.style.textAlign = "right";
        const b1 = document.createElement("button");
        b1.className = "iconBtn";
        b1.textContent = "Edit";
        b1.onclick = () => editItem(i);

        const b2 = document.createElement("button");
        b2.className = "iconBtn del";
        b2.textContent = "Hapus";
        b2.onclick = () => showDeleteConfirm(i);

        tdAct.appendChild(b1);
        tdAct.appendChild(document.createTextNode(" "));
        tdAct.appendChild(b2);

        tr.appendChild(tdNo);
        tr.appendChild(tdText);
        tr.appendChild(tdAct);

        tbody.appendChild(tr);
    });

    document.getElementById("totalCount").innerText = daftar.length;
}

/* SAVE */
function save(){
    localStorage.setItem("soal_asli", JSON.stringify(daftar));
    renderList();
}

/* -------------------------
   INPUT FUNCTIONS
   ------------------------- */
function isRTL(txt){
    return /[\u0600-\u06FF]/.test(txt);
}

function addSoal(){
    const t = document.getElementById("soalInput").value.trim();
    if(!t){ toast("Tulis soal dulu"); return; }

    daftar.push({
        text: t,
        mode: modeArab ? "arab" : "latin",
        direction: modeArab ? "rtl" : "ltr"
    });

    document.getElementById("soalInput").value = "";
    save();
    toast("Soal ditambahkan!");
}

/* EDIT */
let editingIndex = null;
function editItem(i){
    const s = daftar[i];
    document.getElementById("editQuestion").value = s.text;
    document.getElementById("editQuestion").style.direction = s.direction || (s.mode === "arab" ? "rtl" : "ltr");
    document.getElementById("editQuestion").style.textAlign = (s.direction === "rtl" || s.mode === "arab") ? "right" : "left";
    editingIndex = i;
    document.getElementById("editModal").style.display = "flex";
}
function closeEdit(){
    document.getElementById("editModal").style.display = "none";
}
function saveEdit(){
    const newText = document.getElementById("editQuestion").value.trim();
    if(!newText){ toast("Teks kosong"); return; }

    const dir = isRTL(newText) ? "rtl" : "ltr";
    daftar[editingIndex].text = newText;
    daftar[editingIndex].direction = dir;
    daftar[editingIndex].mode = dir === "rtl" ? "arab" : "latin";

    save();
    closeEdit();
    toast("Soal diperbarui!");
}

/* -------------------------
   DELETE & RESET
   ------------------------- */
let deleteIndex = null;
function showDeleteConfirm(i){
    deleteIndex = i;
    document.getElementById("deleteOverlay").style.display = "flex";
}
function hideDeleteConfirm(){
    document.getElementById("deleteOverlay").style.display = "none";
}
function doDelete(){
    if(deleteIndex !== null){
        daftar.splice(deleteIndex, 1);
        save();
        toast("Soal dihapus");
    }
    deleteIndex = null;
    hideDeleteConfirm();
}

function showConfirm(){
    document.getElementById("confirmOverlay").style.display = "flex";
}
function hideConfirm(){
    document.getElementById("confirmOverlay").style.display = "none";
}
function doReset(){
    daftar = [];
    save();
    hideConfirm();
    toast("Semua soal direset");
}

/* -------------------------
   TOGGLE MODE
   ------------------------- */
function toggleMode(){
    modeArab = !modeArab;
    const knob = document.getElementById("knob");
    const inp = document.getElementById("soalInput");
    const label = document.getElementById("modeLabel");

    if(modeArab){
        knob.classList.add("rtl");
        label.textContent = "Arab (RTL)";
        inp.dir = "rtl"; inp.style.textAlign = "right";
    } else {
        knob.classList.remove("rtl");
        label.textContent = "Latin (LTR)";
        inp.dir = "ltr"; inp.style.textAlign = "left";
    }
}

/* -------------------------
   PREVIEW (buka jendela print browser)
   ------------------------- */
function openPreview(){
    if(!daftar.length){ toast("Belum ada soal"); return; }

    const sem = document.getElementById("semester").value;
    const th = document.getElementById("tahun").value;
    const fan = document.getElementById("fan").value;
    const kelas = document.getElementById("kelas").value;

    let html = buildPaperHTML(sem, th, fan, kelas);

    // show preview in a new window (print-friendly)
    const w = window.open('', '_blank');
    w.document.open();
    w.document.write(`
        <html>
        <head>
            <title>Preview Soal</title>
            <meta charset="utf-8" />
            <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
            <style>
                body{ margin:0; font-family: Arial, Helvetica, sans-serif; color:#000; padding:10mm; }
                .paper{ width:210mm; min-height:330mm; box-sizing:border-box; }
                .pdf-arab { font-family: 'Scheherazade New', serif; direction:rtl; text-align:right; }
                table{ width:100%; border-collapse:collapse; }
            </style>
        </head>
        <body>
            <div class="paper">${html}</div>
        </body>
        </html>
    `);
    w.document.close();
    // user can print from browser
}

/* helper untuk membuat HTML isi paper */
function buildPaperHTML(sem, th, fan, kelas){
    let html = `
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">

    <!-- LOGO KIRI -->
    <img 
        src="data:image/jpeg;base64,PASTE_BASE64_LOGO_KIRI_DI_SINI"
        style="width:115px; height:auto;"
    >

    <!-- TENGAH -->
    <div style="
        text-align:center; 
        flex:1; 
        font-size:13pt; 
        font-weight:700; 
        line-height:1.5;
    ">
        UJIAN AKHIR SEMESTER ${sem} <br>
        MUHADHOROH “MANBAUS SHOLAH” <br>
        PONDOK PESANTREN DARUTTAUHID AL ALAWI <br>
        TAHUN PELAJARAN ${th}
    </div>

    <!-- LOGO KANAN -->
    <img 
        src="data:image/jpeg;base64,PASTE_BASE64_LOGO_KANAN_DI_SINI"
        style="width:115px; height:auto;"
    >
</div>

        <div style="border-bottom: 2px solid black; margin: 10px 0 15px 0;"></div>

        <div style="display:flex; gap:10px; margin:18px 0; align-items:flex-start;">
            <table style="width:6.2cm; font-size:12pt; line-height:1.1;">
                <tr>
                    <td style="padding:10px 0; width:auto;">Fan</td><td style="padding:10px 0;">:</td><td style="padding:10px 0;" class="${isArabicText(fan) ? 'pdf-arab-fan' : 'pdf-latin'}">${escapeHtml(fan)}</td>
                </tr>
                <tr>
                    <td style="padding:10px 0;">Kelas</td><td style="padding:10px 0;">:</td><td style="padding:10px 0;">${escapeHtml(kelas)}</td>
                </tr>
            </table>

            <table style="width:8.3cm; font-size:12pt; line-height:1.1;">
                <tr>
                    <td style="padding:10px 0; width:2.6cm;">Nama</td><td style="padding:10px 0; width:0.4cm;">:</td><td style="padding:10px 0;">..................................................</td>
                </tr>
                <tr>
                    <td style="padding:10px 0;">No. Ujian</td><td style="padding:10px 0;">:</td><td style="padding:10px 0;">..................................................</td>
                </tr>
            </table>

            <table style="width:4cm; font-size:12pt; border:1px solid black; text-align:center;">
                <tr><td style="padding:5px; border-bottom:1px solid black; font-weight:bold;">NILAI</td></tr>
                <tr><td style="padding:10px 0;">&nbsp;</td></tr>
            </table>
        </div>

        <div style="border-bottom: 1px solid black; margin: 10px 0 20px 0;"></div>

        <p style="font-size:20pt; font-weight:bold; text-decoration:underline; text-align:center;">
            <span class="pdf-arab" dir="rtl">أجب هذه الأسئلة بأجوبة موافقة !</span>
        </p>
    `;

    daftar.forEach((it, i) => {
        if(it.mode === "arab"){
            html += `
                <div style="font-size:18pt; margin-bottom:12px; direction:rtl;">
                    <table style="width:100%; border-collapse:collapse; font-family:'Scheherazade New', serif;">
                        <tr>
                            <td style="width:28px; white-space:nowrap; vertical-align:top; padding-left:5px;">${toArabicNumber(i+1)}.</td>
                            <td style="text-align:right; vertical-align:top;" class="pdf-arab">${escapeHtml(it.text)}</td>
                        </tr>
                    </table>
                </div>
            `;
        } else {
            html += `
                <div style="font-size:16pt; margin-bottom:12px; direction:ltr;">
                    <table style="width:100%; border-collapse:collapse;">
                        <tr>
                            <td style="width:28px; white-space:nowrap; vertical-align:top; padding-right:4px;">${i+1}.</td>
                            <td style="vertical-align:top;">${escapeHtml(it.text)}</td>
                        </tr>
                    </table>
                </div>
            `;
        }
    });

    return html;
}

/* -------------------------
   DOWNLOAD PDF (modal rename)
   ------------------------- */
function openRename(){
    // isi default filename
    const kelas = document.getElementById("kelas").value || "Kelas";
    const fan = document.getElementById("fan").value || "Mapel";
    const tahun = (document.getElementById("tahun").value || "Tahun").replace(/\//g, "_");

    const defaultName = `${kelas} - ${fan} - ${tahun}`.trim();
    document.getElementById("fileNameInput").value = defaultName;
    document.getElementById("renameModal").style.display = "flex";
}

function closeRename(){
    document.getElementById("renameModal").style.display = "none";
}

function confirmDownloadPDF(){
    const raw = document.getElementById("fileNameInput").value.trim();
    const filename = (raw || "Soal_Ujian").replace(/\s+/g, "_");

    closeRename();
    generatePDF(filename);
}

function generatePDF(filename){
    if(!daftar.length){
        toast("Belum ada soal");
        return;
    }

    const sem = document.getElementById("semester").value;
    const th = document.getElementById("tahun").value;
    const fan = document.getElementById("fan").value;
    const kelas = document.getElementById("kelas").value;

    // HTML isi PDF — sertakan link font & style yang diperlukan di head
    const htmlContent = `
      <!doctype html>
      <html>
      <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <!-- Load Scheherazade New untuk teks Arab -->
        <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
        <style>
          body{ margin:0; font-family: Arial, Helvetica, sans-serif; color:#000; }
          .paper{ width:210mm; min-height:330mm; padding:15mm; box-sizing:border-box; }
          /* Aturan font-size untuk PDF */
          .pdf-arab { font-family: 'Scheherazade New', serif; font-size:16pt; direction:rtl; text-align:right; line-height:1.6; }
          .pdf-arab-fan { font-family: 'Scheherazade New', serif; font-size:14pt; direction:rtl; text-align:right; }
          .pdf-latin { font-size:12pt; direction:ltr; text-align:left; }
          /* layout kecil */
          table{ width:100%; border-collapse:collapse; }
        </style>
      </head>
      <body>
      function isArabicText(txt){
    return /[\u0600-\u06FF]/.test(txt || "");
}
        <div class="paper">
          ${buildPaperHTML(sem, th, fan, kelas)}
        </div>
      </body>
      </html>
    `;

    // Elemen sementara untuk PDF
    const temp = document.createElement("div");
    temp.style.display = "block";
    temp.innerHTML = htmlContent;
    document.body.appendChild(temp);

    // Opsi html2pdf: gunakan ukuran custom (F4 = 210 x 330 mm)
    const opt = {
        margin: 8, // beri sedikit margin supaya tidak terpotong; ubah sesuai kebutuhan
        filename: filename + ".pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: "mm", format: [210, 330], orientation: "portrait" }
    };

    // jalankan export
    html2pdf().set(opt).from(temp).save().then(()=>{
        temp.remove();
    }).catch((err)=>{
        // fallback: bersihkan elemen temp dan beri notifikasi
        temp.remove();
        console.error(err);
        toast("Gagal generate PDF: " + (err.message || err));
    });
}

/* -------------------------
   UTIL
   ------------------------- */
function escapeHtml(str){
    if(!str && str !== 0) return "";
    return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'", "&#039;");
}

/* -------------------------
   INIT
   ------------------------- */
renderList();
</script>
</body>
</html>